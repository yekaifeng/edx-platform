#!/usr/bin/env bash
# Experimental! Not ready for production use.
# Adapted from https://github.com/edx/configuration/tree/master/playbooks/roles/edxapp/templates/edx/bin
set -xeuo pipefail
cd /openedx/app/edxapp/edx-platform
. ../edxapp_env

remove_unwanted_args () {
  ARGS=("")
  args_to_remove="(--list|--noinput)"
  for var in "$@"; do
    # Ignore known unneeded arguments
    if [[ "$var" =~ $args_to_remove ]]; then
      continue
    fi
    ARGS+=("$var")
  done
}

if [[ $@ =~ .*--list.* ]]; then
  remove_unwanted_args $@
  ./manage.py cms showmigrations --database default --settings $EDX_PLATFORM_SETTINGS ${ARGS[@]}
else
  ./manage.py cms migrate --database default --noinput --settings $EDX_PLATFORM_SETTINGS $@
fi
  if [[ $@ =~ .*--list.* ]]; then
  remove_unwanted_args $@
  ./manage.py cms showmigrations --database student_module_history --settings $EDX_PLATFORM_SETTINGS ${ARGS[@]}
else
  ./manage.py cms migrate --database student_module_history --noinput --settings $EDX_PLATFORM_SETTINGS $@
fi
  
